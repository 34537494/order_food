<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        .hedaer {
            height: 3rem;
            width: 100%;
            font-size: 2rem;
            /* background-color: rgba(246, 255, 0,0.7); */
        }

        .container {
            margin: 10px;
            display: flex;
        }

        .menu {
            width: 22rem;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }


        .dishes {
            display: block;
        }

        .type {
            height: 5rem;
            width: 20rem;
            margin: 0.5rem 0;
        }

        .dish {
            display: inline-block;
            height: 10rem;
            width: 20rem;
            background-color: aqua;
            margin: 0.5rem;
        }

        .cart {
            display: flex;
            height: 50px;
            width: 100px;
            margin: auto;
            margin-bottom: 20px;
        }

        .cartButton {
            height: 50px;
            width: 80px;
            margin: auto;
        }

        #dialog {
            height: 500px;
            width: 500px;
        }

        #pay {
            display: flex;
            margin: auto;
            margin-bottom: 10px;
        }

        .checkOutList {
            display: flex;
            margin: auto;
        }

        .setNum {
            /* display: flex; */
            height: 20px;
            float: right;
            margin-right: 5px;
        }
    </style>
</head>

<body>
    <div class="hedaer">点餐系统</div>
    <div class="container">
        <!-- 菜单 -->
        <div class="menu">
            <button class="type" onclick="openTab(event, 's1')">品类1</button>
            <button class="type" onclick="openTab(event, 's2')">品类2</button>
            <button class="type" onclick="openTab(event, 's3')">品类3</button>
        </div>

        <!-- 菜品 -->
        <div class="show">
            <div class="dishes" id="s1">
                <!-- <div style="display: inline-block; width: 20rem;"> -->
                <div class="dish">
                    <div id="d1" style="height: 8rem; width: 20rem;">
                        <div class="img"></div>
                        <div class="name"></div>
                        <div class="price"></div>
                    </div>
                    <div class="setNum">
                        <button onclick="minusNum('num1_1')">-</button>
                        <input style="width: 30px;" type="text" id="num1_1" value=0>
                        <button onclick="addNum('num1_1')">+</button>
                        <button onclick="addToCart('name1_1',11,'num1_1')">提交</button>
                        <button onclick="deleteFromCart('name1_1','num1_1')">清空</button>
                    </div>
                </div>
                <div class="dish">
                    <div id="d2" style="height: 8rem; width: 20rem;">
                        <div class="img"></div>
                        <div class="name"></div>
                        <div class="price"></div>
                    </div>
                    <div class="setNum">
                        <button onclick="minusNum('num1_2')">-</button>
                        <input style="width: 30px;" type="text" id="num1_2" value=0>
                        <button onclick="addNum('num1_2')">+</button>
                        <button onclick="addToCart('name1_2',11,'num1_2')">提交</button>
                        <button onclick="deleteFromCart('name1_2','num1_2')">清空</button>
                    </div>
                </div>
                <!-- <div class="dish" id="d2" onclick="addToCart('name1_2',22)">
                    <div class="img"></div>
                    <div class="name"></div>
                    <div class="price"></div>
                </div> -->
                <div class="dish">
                    <div id="d3" style="height: 8rem; width: 20rem;">
                        <div class="img"></div>
                        <div class="name"></div>
                        <div class="price"></div>
                    </div>
                    <div class="setNum">
                        <button onclick="minusNum('num1_3')">-</button>
                        <input style="width: 30px;" type="text" id="num1_3" value=0>
                        <button onclick="addNum('num1_3')">+</button>
                        <button onclick="addToCart('name1_3',11,'num1_3')">提交</button>
                        <button onclick="deleteFromCart('name1_3','num1_3')">清空</button>
                    </div>
                </div>
                <div class="dish">
                    <div id="d4" style="height: 8rem; width: 20rem;">
                        <div class="img"></div>
                        <div class="name"></div>
                        <div class="price"></div>
                    </div>
                    <div class="setNum">
                        <button onclick="minusNum('num1_4')">-</button>
                        <input style="width: 30px;" type="text" id="num1_4" value=0>
                        <button onclick="addNum('num1_4')">+</button>
                        <button onclick="addToCart('name1_4',11,'num1_4')">提交</button>
                        <button onclick="deleteFromCart('name1_4','num1_4')">清空</button>
                    </div>
                </div>
            </div>
            <div class="dishes" id="s2">
                <div class="dish">
                    <div id="d5" style="height: 8rem; width: 20rem;">
                        <div class="img"></div>
                        <div class="name"></div>
                        <div class="price"></div>
                    </div>
                    <div class="setNum">
                        <button onclick="minusNum('num2_1')">-</button>
                        <input style="width: 30px;" type="text" id="num2_1" value=0>
                        <button onclick="addNum('num2_1')">+</button>
                        <button onclick="addToCart('name2_1',11,'num2_1')">提交</button>
                        <button onclick="deleteFromCart('name2_1','num2_1')">清空</button>
                    </div>
                </div>
                <div class="dish">
                    <div id="d6" style="height: 8rem; width: 20rem;">
                        <div class="img"></div>
                        <div class="name"></div>
                        <div class="price"></div>
                    </div>
                    <div class="setNum">
                        <button onclick="minusNum('num2_2')">-</button>
                        <input style="width: 30px;" type="text" id="num2_2" value=0>
                        <button onclick="addNum('num2_2')">+</button>
                        <button onclick="addToCart('name2_2',11,'num2_2')">提交</button>
                        <button onclick="deleteFromCart('name2_2','num2_2')">清空</button>
                    </div>
                </div>
                <div class="dish">
                    <div id="d7" style="height: 8rem; width: 20rem;">
                        <div class="img"></div>
                        <div class="name"></div>
                        <div class="price"></div>
                    </div>
                    <div class="setNum">
                        <button onclick="minusNum('num2_3')">-</button>
                        <input style="width: 30px;" type="text" id="num2_3" value=0>
                        <button onclick="addNum('num2_3')">+</button>
                        <button onclick="addToCart('name2_3',11,'num2_3')">提交</button>
                        <button onclick="deleteFromCart('name2_3','num2_3')">清空</button>
                    </div>
                </div>
            </div>
            <div class="dishes" id="s3" onclick="addToCart('name3_1',31)">
                <div class="dish">
                    <div id="d8" style="height: 8rem; width: 20rem;">
                        <div class="img"></div>
                        <div class="name"></div>
                        <div class="price"></div>
                    </div>
                    <div class="setNum">
                        <button onclick="minusNum('num3_1')">-</button>
                        <input style="width: 30px;" type="text" id="num3_1" value=0>
                        <button onclick="addNum('num3_1')">+</button>
                        <button onclick="addToCart('name3_1',11,'num3_1')">提交</button>
                        <button onclick="deleteFromCart('name3_1','num3_1')">清空</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="cart">
            <button class="cartButton" onclick="checkOut()">
                <img src="./src/img/cart.jpg" width="50" alt="结算">
            </button>
        </div>
    </div>

    <dialog id="dialog">
        <p>请确认你选择的菜品</p>
        <form method="dialog">
            <div id="checkOutCart"></div>
            <button id="pay">确认支付</button>
        </form>
    </dialog>

    <script>
        var shoppingList = [];
        var priceList = [];
        var shoppingNum = [];
        var openCheckout = false;
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("dishes");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("type");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        document.getElementsByClassName("type")[0].click();

        // 选择菜品数量的增减键的方法
        function addNum(numId) {
            document.getElementById(numId).value = parseInt(document.getElementById(numId).value) + 1;
        }

        function minusNum(numId) {
            if (document.getElementById(numId).value > 0) {
                document.getElementById(numId).value = parseInt(document.getElementById(numId).value) - 1;
            }
            else {
                alert("请输入正确的菜品数量")
            }
        }

        function addToCart(name, price, numId) {
            // 判断数量是否正确，不正确重置一下
            if (document.getElementById(numId).value <= 0) {
                alert('请选择正确的数量再进行提交');
                // 如果数据错误并且原本有数据，则将原本的数据再进行展示，否则为0
                if (shoppingList.indexOf(name) !== -1) {
                    document.getElementById(numId).value = shoppingNum[shoppingList.indexOf(name)];
                }
                else {
                    document.getElementById(numId).value = 0;

                }
                return;
            }
            // 判断是否选择，如果没有选择就添加进购物车，如果有则增加数量
            if (shoppingList.indexOf(name) === -1) {
                shoppingList.push(name);
                priceList.push(price);
                // console.log(document.getElementById(numId).value)
                shoppingNum.push(document.getElementById(numId).value);
            }
            else {
                shoppingNum[shoppingList.indexOf(name) - 1] = document.getElementById(numId).value;
            }
        }
        function deleteFromCart(name, numId) {
            // 如果不存在菜品提示
            if (shoppingList.indexOf(name) === -1) {
                alert("你没有选择该菜品无法清空")
            }
            // 如果已经在菜谱中则清除数据
            else {
                shoppingList.splice(shoppingList.indexOf(name), 1);
                priceList.splice(shoppingList.indexOf(name), 1);
                shoppingNum.splice(shoppingList.indexOf(name), 1);
                document.getElementById(numId).value = 0;
            }
        }

        function checkOut() {
            var cartStr = "";
            // 将购物车列表和价格列表展示在dialog的界面上
            for (let i = 0; i < shoppingList.length; i++) {
                cartStr += "<div class='checkOutList'> " + shoppingList[i] + "*" + shoppingNum[i] + "………………￥" + priceList[i] * shoppingNum[i] + "</div>";
            };
            // 拼接完字符串数组后用innerHTML把它渲染到页面中
            document.getElementById("checkOutCart").innerHTML = cartStr;
            // 使dialog界面展示出来
            document.getElementById("dialog").showModal();
        }
    </script>

</body>

</html>